--<<전체 sql이며, 수정 될 때 마다 커밋메시지에 뭘 수정했는지도 써주세요>>

--<< 0. homey 기존 유저 삭제하고 싶을 때, (처음에는 1번부터 시작해주세요) >>
--sys 계정으로 들어가
select sid,serial#,username,status from vesession where schemaname = 'TALKDOG';
--그 후 sid, serial를 차례대로 ','안에 넣음 (여러 개 일시 모두 다 )
alter system kill SESSION 'sid,serial';
--삭제
DROP USER TALKDOG CASCADE;

--<< 1. homey user 등록하기 (SYS 계정에서 실시) >>
CREATE USER homey IDENTIFIED BY 1111; GRANT RESOURCE, CREATE SESSION TO homey;

--<< 1-2. 계정에 권한을 생성 >>
grant connect, dba, resource to homey;

--<< 2. homey 오라클 db에 접속하기>>

--<< 3. 테이블 CREATE, ALTER(key값)>>
--멤버
CREATE TABLE member (
    mid VARCHAR2(50) NOT NULL,
    pw VARCHAR2(50) NOT NULL,
    mname VARCHAR2(50) NOT NULL,
    maddr VARCHAR2(150) NOT NULL,
    memail VARCHAR2(100) NOT NULL,
    mphone VARCHAR2(100) NOT NULL,
    mdate DATE DEFAULT SYSDATE NULL
);
--멤버끝

--하영시작
CREATE TABLE consult (
    consultNo NUMBER NOT NULL,
    mid VARCHAR2(50) NOT NULL,
    mphone VARCHAR2(50) NOT NULL,
    postcode VARCHAR2(50) NOT NULL,
    address VARCHAR2(100) NOT NULL,
    detailAddress VARCHAR2(100) NOT NULL,
    buildingType VARCHAR2(100) NOT NULL,
    scheduledDate VARCHAR2(50) NOT NULL,
    budget NUMBER NOT NULL,
    pyeongsu NUMBER NOT NULL,
    happyCall VARCHAR2(100) NOT NULL,
    consultDate DATE DEFAULT SYSDATE NOT NULL,
    status VARCHAR2(100) NOT NULL
);

CREATE TABLE quotation (
    quoNo NUMBER NOT NULL,
    itemNo NUMBER NOT NULL,
    consultNo NUMBER NOT NULL,
    quoDate DATE DEFAULT SYSDATE NOT NULL,
    constScheduleStart VARCHAR2(100) NOT NULL,
    constScheduleEnd VARCHAR2(100) NOT NULL,
    constTotal NUMBER NOT NULL,
    demolTotal NUMBER NOT NULL,
    total NUMBER NOT NULL
);

CREATE TABLE notice (
    notNo NUMBER NOT NULL,
    mid VARCHAR2(50) NOT NULL,
    notCategory VARCHAR2(50) NOT NULL,
    notTitle VARCHAR2(999) NOT NULL,
    notCont VARCHAR2(999) NOT NULL,
    notHit NUMBER NOT NULL,
    notImage VARCHAR2(100) NULL,
    notDate DATE DEFAULT SYSDATE NOT NULL
);

CREATE TABLE item (
    itemNo NUMBER NOT NULL,
    consultNo NUMBER NOT NULL,
    tiling NUMBER NULL,
    tilingD NUMBER NULL,
    flooring NUMBER NULL,
    flooringD NUMBER NULL,
    kitchen NUMBER NULL,
    kitchenD NUMBER NULL,
    bathroom NUMBER NULL,
    bathroomD NUMBER NULL,
    entrance NUMBER NULL,
    entranceD NUMBER NULL,
    balcony NUMBER NULL,
    balconyD NUMBER NULL,
    lighting NUMBER NULL,
    lightingD NUMBER NULL,
    door NUMBER NULL,
    doorD NUMBER NULL,
    etc NUMBER NULL,
    othersD NUMBER NULL
);


CREATE TABLE noticeAttach (
    uuid VARCHAR2(100) NOT NULL,
    notNo NUMBER NOT NULL,
    upfolder VARCHAR2(200) NOT NULL,
    filename VARCHAR2(100) NOT NULL,
    image CHAR(1) NULL
);

CREATE TABLE visit (
    visitNo NUMBER NOT NULL,
    consultNo NUMBER NOT NULL,
    visitDate DATE NOT NULL,
    visitStatus CHAR(1) DEFAULT '0' NOT NULL
);

ALTER TABLE consult ADD CONSTRAINT PK_CONSULT PRIMARY KEY (
    consultNo
);

ALTER TABLE quotation ADD CONSTRAINT PK_QUOTATION PRIMARY KEY (
    quoNo
);

ALTER TABLE notice ADD CONSTRAINT PK_NOTICE PRIMARY KEY (
    notNo
);

ALTER TABLE member ADD CONSTRAINT PK_MEMBER PRIMARY KEY (
    mid
);

ALTER TABLE item ADD CONSTRAINT PK_ITEM PRIMARY KEY (
    itemNo
);

ALTER TABLE noticeAttach ADD CONSTRAINT PK_NOTICEATTACH PRIMARY KEY (
    uuid
);

ALTER TABLE visit ADD CONSTRAINT PK_VISIT PRIMARY KEY (
    visitNo
);

ALTER TABLE consult ADD CONSTRAINT FK_member_TO_consult_1 FOREIGN KEY (
    mid
)
REFERENCES member (
    mid
);

ALTER TABLE quotation ADD CONSTRAINT FK_item_TO_quotation_1 FOREIGN KEY (
    itemNo
)
REFERENCES item (
    itemNo
);

ALTER TABLE quotation ADD CONSTRAINT FK_consult_TO_quotation_1 FOREIGN KEY (
    consultNo
)
REFERENCES consult (
    consultNo
);

ALTER TABLE notice ADD CONSTRAINT FK_member_TO_notice_1 FOREIGN KEY (
    mid
)
REFERENCES member (
    mid
);

ALTER TABLE item ADD CONSTRAINT FK_consult_TO_item_1 FOREIGN KEY (
    consultNo
)
REFERENCES consult (
    consultNo
);

ALTER TABLE noticeAttach ADD CONSTRAINT FK_notice_TO_noticeAttach_1 FOREIGN KEY (
    notNo
)
REFERENCES notice (
    notNo
);

ALTER TABLE visit ADD CONSTRAINT FK_consult_TO_visit_1 FOREIGN KEY (
    consultNo
)
REFERENCES consult (
    consultNo
);
--하영끝




--<< 4. 시퀀스, 트리거 생성>>

--하영시작 
-- notice 시퀀스
-- consult 시퀀스
-- visit 시퀀스
-- quotation 시퀀스
CREATE SEQUENCE notice_seq INCREMENT BY 1 START WITH 1;
CREATE SEQUENCE consult_seq INCREMENT BY 1 START WITH 1;
CREATE SEQUENCE visit_seq INCREMENT BY 1 START WITH 1;
CREATE SEQUENCE quotation_seq INCREMENT BY 1 START WITH 1;
--하영 끝


--<< 5. 각 테이블에 테스트용 데이터 insert 하기 >>

--하영시작
-- notice insert(5번 돌리기)
INSERT INTO notice values(NOTICE_SEQ.NEXTVAL, '공지사항', '공지사항입니다', '8월 16일 오전 9시부터 서버 점검이 있을 예정입니다. 홈페이지 이용에 참고 바랍니다.', 0, '../resources/images/null', SYSDATE);
INSERT INTO notice values(NOTICE_SEQ.NEXTVAL, '이벤트', '230707이벤트!', '이벤트 시작합니다!', 0, '../resources/images/null', '2023-07-07');
--하영끝

--<< 6. 번외 테이블을 삭제하고 싶다면? >>
---- 테이블 삭제 구문

--하영시작
--테이블 삭제 순서대로 해야함
DROP TABLE quotation;
DROP TABLE visit;
DROP TABLE item;
DROP TABLE consult;
DROP TABLE noticeAttach;
DROP TABLE notice;
DROP TABLE member;
--하영끝


